---
description: 共享处方组件和弹窗的使用规范
globs:
  - "src/components/PrescriptionComponents/**/*.{tsx,ts,less}"
  - "src/components/PrescriptionModals/**/*.{tsx,ts}"
  - "src/pages/**/components/**/*.tsx"
  - "src/pages/**/*.tsx"
---

# 共享处方组件使用规范

## 组件目录结构

### PrescriptionComponents (处方展示组件)
位置: `src/components/PrescriptionComponents/`

**组件列表:**
- `MedicationTreatment` - 药物治疗展示
- `CognitiveTraining` - 认知训练展示
- `DietPrescription` - 饮食处方展示
- `ExercisePrescription` - 运动处方展示

**导入方式:**
```typescript
import {
  MedicationTreatment,
  CognitiveTraining,
  DietPrescription,
  ExercisePrescription,
} from '@/components/PrescriptionComponents';

// 或者
import { MedicationTreatment } from '@/components';
```

### PrescriptionModals (处方弹窗组件)
位置: `src/components/PrescriptionModals/`

**组件列表:**
- `PrescriptionDetailModal` - 处方详情查看弹窗（只读）
- `PrescriptionEditModal` - 处方编辑弹窗（可编辑）

**导入方式:**
```typescript
import { PrescriptionDetailModal, PrescriptionEditModal } from '@/components/PrescriptionModals';

// 或者
import { PrescriptionDetailModal, PrescriptionEditModal } from '@/components';
```

## 使用规范

### 1. PrescriptionDetailModal 使用

**适用场景:** 只读查看处方详情

**Props 接口:**
```typescript
interface PrescriptionDetailModalProps {
  visible: boolean;              // 弹窗显示状态
  title?: string;                // 弹窗标题，默认 "康复处方详情"
  prescription: PrescriptionData | null;  // 处方数据
  extraInfo?: React.ReactNode;   // 额外信息（显示在处方上方）
  onCancel: () => void;          // 取消回调
}

interface PrescriptionData {
  medications?: any[];           // 药物列表
  cognitiveCards?: any[];        // 认知训练卡片
  dietContent?: string;          // 饮食处方内容
  exercises?: any[];             // 运动处方列表
}
```

**使用示例:**
```typescript
const [detailModalVisible, setDetailModalVisible] = useState(false);
const [viewingRecord, setViewingRecord] = useState<any>(null);

// 在 JSX 中
<PrescriptionDetailModal
  visible={detailModalVisible}
  title="诊疗记录详情"
  prescription={viewingRecord?.prescription}
  extraInfo={
    <>
      <p><strong>日期：</strong>{viewingRecord?.date}</p>
      <p><strong>医生：</strong>{viewingRecord?.doctor}</p>
    </>
  }
  onCancel={() => setDetailModalVisible(false)}
/>
```

### 2. PrescriptionEditModal 使用

**适用场景:** 编辑或新增处方

**Props 接口:**
```typescript
interface PrescriptionEditModalProps {
  visible: boolean;              // 弹窗显示状态
  title?: string;                // 弹窗标题，默认 "修改康复处方"
  initialData?: PrescriptionData;  // 初始数据（编辑时传入）
  onCancel: () => void;          // 取消回调
  onSuccess: (data: PrescriptionData) => void;  // 成功回调，返回处方数据
}
```

**使用示例:**
```typescript
const [editModalVisible, setEditModalVisible] = useState(false);
const [editingRecord, setEditingRecord] = useState<any>(null);

const handleEditSuccess = (prescriptionData: PrescriptionData) => {
  console.log('保存处方数据:', prescriptionData);
  message.success('修改成功');
  setEditModalVisible(false);
  // 刷新列表
  actionRef.current?.reload();
};

// 在 JSX 中
<PrescriptionEditModal
  visible={editModalVisible}
  title="修改康复处方"
  initialData={editingRecord?.prescription}
  onCancel={() => setEditModalVisible(false)}
  onSuccess={handleEditSuccess}
/>
```

## 重构指南

### 从内联弹窗迁移到共享组件

**旧的实现方式（不推荐）:**
```typescript
// ❌ 大量重复的状态管理
const [medications, setMedications] = useState([]);
const [cognitiveCards, setCognitiveCards] = useState([]);
const [medicationModalVisible, setMedicationModalVisible] = useState(false);
// ... 更多状态和处理函数

// ❌ 大量重复的 Modal JSX 代码
<Modal title="修改康复处方" ...>
  <MedicationTreatment ... />
  <CognitiveTraining ... />
  // ... 更多组件
</Modal>

<Modal title="添加药物" ...>
  <Form>...</Form>
</Modal>
// ... 更多子弹窗
```

**新的实现方式（推荐）:**
```typescript
// ✅ 简洁的状态管理
const [editModalVisible, setEditModalVisible] = useState(false);
const [editingRecord, setEditingRecord] = useState(null);

// ✅ 简洁的组件使用
<PrescriptionEditModal
  visible={editModalVisible}
  initialData={editingRecord?.prescription}
  onCancel={() => setEditModalVisible(false)}
  onSuccess={handleSuccess}
/>
```

### 迁移步骤

1. **移除旧的状态和处理函数**
   - 删除处方相关的 useState
   - 删除子弹窗的状态管理
   - 删除增删改查的处理函数

2. **替换 Modal 组件**
   - 详情查看 → `PrescriptionDetailModal`
   - 处方编辑 → `PrescriptionEditModal`

3. **简化回调处理**
   - 只需实现 `onSuccess` 回调
   - 在回调中处理数据保存和列表刷新

## 样式引用

处方组件的样式已统一管理，组件会自动引入样式，无需手动导入：

```typescript
// ❌ 不需要手动导入样式
// import '@/components/PrescriptionComponents/index.less';

// ✅ 组件内部已自动引入
import { PrescriptionDetailModal } from '@/components/PrescriptionModals';
```

## 最佳实践

### 1. 统一使用共享组件
- 所有处方相关的弹窗都应使用 `PrescriptionDetailModal` 或 `PrescriptionEditModal`
- 不要在页面中重复实现处方弹窗逻辑

### 2. 数据格式标准化
```typescript
// 标准的处方数据格式
interface PrescriptionData {
  medications: Array<{
    id: string;
    medicineName: string;
    usage: string;
    dosage: string;
  }>;
  cognitiveCards: Array<{
    id: string;
    cardName: string;
    difficulty: string;
  }>;
  dietContent: string;
  exercises: Array<{
    id: string;
    exerciseName: string;
    duration: string;
  }>;
}
```

### 3. 错误处理
```typescript
const handleSuccess = (data: PrescriptionData) => {
  try {
    // 保存数据
    await savePrescription(data);
    message.success('保存成功');
    setModalVisible(false);
    actionRef.current?.reload();
  } catch (error) {
    message.error('保存失败');
    console.error(error);
  }
};
```

## 注意事项

1. **不要修改共享组件内部实现**
   - 如需新功能，通过 props 扩展
   - 如需定制，考虑创建新的专用组件

2. **保持数据结构一致**
   - 确保传入的数据符合 `PrescriptionData` 接口
   - 使用 TypeScript 类型检查

3. **处理空数据**
   - 组件会自动处理空数据情况
   - 只显示有数据的处方类型

4. **性能优化**
   - 避免频繁打开/关闭弹窗
   - 使用 `useCallback` 优化回调函数
