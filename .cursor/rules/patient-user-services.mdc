---
description: Patient user service layer type definitions and conventions
globs: src/services/patient-user/**/*.ts
alwaysApply: false
---

# Patient User Service Layer

## Type Definitions

### Interface Naming
- Use descriptive names ending with type suffix
- List items: `UserListItem`, `VisitRecord`, `DiagnosisRecord`
- Detail info: `UserDetailInfo`
- Request params: `UserListParams`

### Required Fields
All patient user interfaces must include:
- `id: string` - Unique identifier
- Timestamps as strings in format: `'YYYY-MM-DD HH:mm:ss'` or `'YYYY/MM/DD'`

### Gender Field
```typescript
// ✅ GOOD
gender: 'male' | 'female';

// ❌ BAD
gender: string;
gender: 0 | 1;
```

### Status Fields
Use numeric status codes:
```typescript
// ✅ GOOD
status: number; // 0 = incomplete, 1 = complete

// ❌ BAD
status: 'completed' | 'pending';
status: boolean;
```

## Structured Data

### Prescription Objects
Use structured objects instead of plain strings for complex data:

```typescript
// ✅ GOOD
prescription?: {
  medications: MedicationTreatment[];
  cognitiveCards: CognitiveTrainingCard[];
  dietContent: string;
  exercises: ExercisePrescription[];
};

// ❌ BAD
prescription?: string;
```

### Nested Types
Define separate interfaces for nested structures:

```typescript
// ✅ GOOD
export interface MedicationTreatment {
  id: string;
  medicineName: string;
  usage: string;
  dosage: string;
}

export interface DiagnosisRecord {
  prescription?: {
    medications: MedicationTreatment[];
  };
}
```

## Field Naming Conventions

### Chinese Context Fields
Use descriptive English names that reflect Chinese medical terms:
- `chiefComplaint` - 主诉
- `currentHistory` - 现病史
- `familyHistory` - 家族史
- `existingDisease` - 既往病史
- `existingMedication` - 既往用药
- `emergencyContact` - 紧急联系人
- `diagnosisScore` - 诊疗评分
- `prescriptionScore` - 处方日评分

### AI-Related Fields
Prefix AI-generated content with `AI`:
```typescript
// ✅ GOOD
AIComprehensiveEfficacyEvaluationSuggestion: string;

// ❌ BAD
aiSuggestion: string;
suggestion: string;
```

## Export Organization

Export all types from `typings.d.ts`:
```typescript
// ✅ GOOD - Single source of truth
export interface UserListItem { ... }
export interface UserDetailInfo { ... }
export interface DiagnosisRecord { ... }
```

## Compatibility

### Legacy Support
When adding new structured fields, keep old fields for backward compatibility:

```typescript
// ✅ GOOD
export interface DiagnosisRecord {
  rehabilitationPlan?: string; // 旧版文字处方（兼容）
  prescription?: {              // 新版结构化处方
    medications: MedicationTreatment[];
  };
}
```
